---
title: "Chapter2 統計の基礎"
output: 
  github_document:
    toc: TRUE
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE)
set.seed(123)
```

## 2.1 尺度水準
- 人種、車のメーカー、社員の所属部署
- 順位、成績(優/良/可/不可)、顧客満足度
- 温度、日付
- 長さ、重さ、割合に意味があるもの

## 2.2 代表値
平均を求める関数はmean()。
```{r}
X = c(0, 7, 8, 9, 100)
mean(X)
```

mean関数には、na.rmというオプションがある。
```{r}
Y = c(0, 7, 8, NA, 0/0)
Y
mean(Y)
mean(Y, na.rm = TRUE)
```

mean関数には、trimというオプションもある。
```{r}
mean(X, trim = 0.2)
mean(Y, trim = 0.2)
mean(Y, trim = 0.2, na.rm = TRUE)
```

中央値はmedian()という関数で求める。
```{r}
median(X)
median(Y)
median(Y, na.rm = TRUE)
```

平均値と中央値、どちらを使ったらいいかは、ヒストグラムの形によってことなる。

```{r}
hist(rnorm(10000)) # 標準正規分布のヒストグラム
hist(rchisq(10000, 10)) # 自由度10のカイ二乗分布の(以下略)
hist(rcauchy(10000)) # コーシー分布の(以下略)
```

## 2.3 確率変数、乱数、母集団、標本

確率変数と乱数は同じ意味合い。ただし、教科書では、以下の二つのルールに従っている。

1. 確率変数が何らかの「同じ種類のヒストグラム(確率分布が同じ, identically distibuted)」にしたがい
1. 乱数を選ぶときは、「選ぶ」という行為が互いに影響を与えない(独立, independent)

母集団と標本の関係を会社で例えると、

- 母集団：社員全員
- 大きさnの(一つの)標本：社員をランダムにn人選んだときの集団 ※ nのことを(サンプル)サイズという。標本数とは言わない。

母平均と標本平均を、上記の母集団と標本の身長を例に考えてみる。

- 身長の母平均：社員全員の身長の平均。何回計算しても同じ値。
- 身長の標本平均：社員をランダムにn人選んだときの集団の身長の平均。選ぶたびに値が変わる。

標本平均は必ずしも母平均とは等しくならないが、①(サンプル)サイズを増やしたり、②標本数を増やすと、母平均に近づく。

例えば、標準正規分布から5個乱数を選んだ時(サンプルサイズ5の1標本)の平均は、何回繰り返しても、0にならない。
```{r}
mean(rnorm(5)) 
```


①標準正規分布から1万個の乱数を選んだ時(サンプルサイズ1万個の1標本)の平均はより0に近い。
```{r}
mean(rnorm(10000))
```

②「標準正規分布から5個乱数を選んだ時の平均」を1万個計算(サンプルサイズ5の1万標本)して、その平均をとったときの値は、より0に近い。
```{r}
mean(replicate(10000, mean(rnorm(5))))
```

平均には以下の性質がある(線形性、というが、覚えなくてよい)。
```{r}
X = c(1,2,3,4,5)
Y = c(5,3,1,8,9)
```

```{r}
2 * X
3 * Y
mean(2 * X + 3 * Y) # この計算と…
2 * mean(X) + 3 * mean(Y) # この計算が、同じ値になる性質を、線形性という
```

## 2.4 分散と標準偏差

分散あるいは母分散、またはその平方根である標準偏差は、確率分布(ヒストグラム)のばらつきの度合いを表す。
正規分布で見てみよう。

```{r}
hist(rnorm(10000)) # 標準正規分布のヒストグラム。つまり、標準偏差は1、分散も1。
hist(rnorm(10000, sd = 2)) # 平均0、標準偏差は2(分散なら4)の正規分布
hist(rnorm(10000, sd = 10)) # 平均0、標準偏差は10(分散なら100)の正規分布
```

あるサイズnの標本の分散を計算したいが、分散の計算式には、母平均を使うことになっている。
しかし、母平均は分からないことも多い(例えば、母集団を東京都民とすると、その身長の母平均を求めるのは困難を極める)。
なので、標本分散の計算に、母平均ではなく、標本平均を使う。
また、このときサンプルサイズnで割らず、n-1で割る。
すると、この計算で求めた標本分散の平均は母分散と一致する。
n-1で割らず、nで割ると、母分散と一致しない。
「n-1で割る分散」の意味を確かめるために、数値実験をしてみよう。

```{r}
x = 1:5 # 母集団
x
var(x) # 母分散
var(c(2,3,4,5)) # 標本分散1
var(c(1,3,4,5)) # 標本分散2
var(c(1,2,4,5)) # 標本分散3
var(c(1,2,3,5)) # 標本分散4
var(c(1,2,3,4)) # 標本分散5
#　標本分散の平均 = 母分散
mean(c(var(c(2,3,4,5)), var(c(1,3,4,5)), var(c(1,2,4,5)), var(c(1,2,3,5)), var(c(1,2,3,4))))
```

「nで割る分散」で数値実験をしてみる。

まずは、「nで割る分散」を計算する関数を作る。
```{r}
varp <- function(x){var(x) * (length(x) - 1) / length(x)} 
```

```{r}
varp(x) # 母分散
varp(c(2,3,4,5)) # 標本分散1
varp(c(1,3,4,5)) # 標本分散2
varp(c(1,2,4,5)) # 標本分散3
varp(c(1,2,3,5)) # 標本分散4
varp(c(1,2,3,4)) # 標本分散5
#　標本分散の平均 ≠ 母分散
mean(c(varp(c(2,3,4,5)), varp(c(1,3,4,5)), varp(c(1,2,4,5)), varp(c(1,2,3,5)), varp(c(1,2,3,4))))
```

「n-1で割る分散」(の平均値)は、母分散からのズレ(バイアス、bias)がない。
なので、このズレのなさ(＝偏りのなさ)から、不偏分散、または母分散の不偏推定量という。

sd関数は、標本の標準偏差を求める。計算式は、不偏分散の平方根である。
```{r}
x = 1:10
var(x)
sqrt(var(x))
sd(x)
varp(x)
sqrt(varp(x))
```

